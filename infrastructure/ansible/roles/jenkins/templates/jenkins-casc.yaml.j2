# =============================================================================
# Jenkins Configuration as Code (CasC) - Generated by Ansible
# =============================================================================
# NOTE: Simplified CasC to avoid compatibility issues with plugins
# Job is created separately via config.xml file

# -----------------------------------------------------------------------------
# Credentials
# -----------------------------------------------------------------------------
credentials:
  system:
    domainCredentials:
      - credentials:
{% if jira_email is defined and jira_api_token is defined and jira_api_token %}
          # JIRA Credentials (for issue creation on build failure)
          - usernamePassword:
              id: "jira-credentials"
              username: "{{ jira_email }}"
              password: "{{ jira_api_token }}"
              description: "JIRA API credentials for automated issue creation"
              scope: GLOBAL
{% endif %}
{% if docker_hub_username is defined and docker_hub_token is defined and docker_hub_token %}
          # Docker Hub Credentials
          - usernamePassword:
              id: "docker-hub-credentials"
              username: "{{ docker_hub_username }}"
              password: "{{ docker_hub_token }}"
              description: "Docker Hub credentials for image push"
              scope: GLOBAL
{% endif %}
{% if github_username is defined and github_token is defined and github_token %}
          # GitHub Credentials
          - usernamePassword:
              id: "github-credentials"
              username: "{{ github_username }}"
              password: "{{ github_token }}"
              description: "GitHub credentials for repository access"
              scope: GLOBAL
{% endif %}
{% if ssh_private_key_b64 is defined and ssh_private_key_b64 %}
          # AWS SSH Key (for deployment)
          - basicSSHUserPrivateKey:
              id: "aws-ssh-key"
              username: "ec2-user"
              description: "AWS EC2 SSH key for deployment"
              scope: GLOBAL
              privateKeySource:
                directEntry:
                  privateKey: "{{ ssh_private_key_b64 | b64decode }}"
{% endif %}

jenkins:
  systemMessage: "DevOps Testing App - CI/CD Pipeline ({{ environment }})"
  numExecutors: 4
  mode: NORMAL
  
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "{{ jenkins_admin_user | default('admin') }}"
          name: "Administrator"
          password: "{{ jenkins_admin_password | default('DevOps2026!') }}"
  
  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false

# -----------------------------------------------------------------------------
# Unclassified
# -----------------------------------------------------------------------------
unclassified:
  location:
    url: "http://{{ ansible_host }}:{{ jenkins_port | default(8080) }}/"
    adminAddress: "{{ notification_email | default('admin@devops-testing-app.com') }}"

  # ---------------------------------------------------------------------------
  # Email Configuration (SMTP)
  # ---------------------------------------------------------------------------
  mailer:
    smtpHost: "{{ smtp_host | default('smtp.gmail.com') }}"
    smtpPort: "{{ smtp_port | default('587') }}"
    useSsl: false
    useTls: true
    charset: "UTF-8"
    defaultSuffix: "@gmail.com"
{% if smtp_username is defined and smtp_username %}
    authentication:
      username: "{{ smtp_username }}"
      password: "{{ smtp_password }}"
{% endif %}

  email-ext:
    defaultRecipients: "{{ notification_email | default('daniel.mazhbits@gmail.com') }}"
    defaultReplyTo: "no-reply@devops-testing-app.com"
    defaultContentType: "text/html"
    mailAccount:
      smtpHost: "{{ smtp_host | default('smtp.gmail.com') }}"
      smtpPort: "{{ smtp_port | default('587') }}"
      useSsl: false
      useTls: true
{% if smtp_username is defined and smtp_username %}
      smtpUsername: "{{ smtp_username }}"
      smtpPassword: "{{ smtp_password }}"
{% endif %}
