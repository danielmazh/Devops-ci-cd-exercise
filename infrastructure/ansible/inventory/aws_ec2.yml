# =============================================================================
# DevOps Testing App - Ansible Dynamic AWS Inventory
# =============================================================================
# Uses AWS EC2 plugin to discover instances by tags
# =============================================================================

plugin: aws_ec2

regions:
  - us-east-1

# AWS credentials (uses ~/.aws/credentials or environment variables)
# aws_access_key: "{{ lookup('env', 'AWS_ACCESS_KEY_ID') }}"
# aws_secret_key: "{{ lookup('env', 'AWS_SECRET_ACCESS_KEY') }}"

# Filter by project tags
filters:
  "tag:Project": "devops-testing-app"
  "tag:ManagedBy": "terraform"
  instance-state-name: running

# Create groups based on tags
keyed_groups:
  # Group by Role tag (jenkins, application)
  - key: tags.Role
    prefix: role
    separator: "_"
  
  # Group by Environment tag
  - key: tags.Environment
    prefix: env
    separator: "_"

# Host variables
hostnames:
  - public-ip-address

compose:
  ansible_host: public_ip_address
  ansible_user: "'ec2-user'"
  ansible_ssh_private_key_file: "'/Users/danielmazmazhbits/keys/daniel-devops.pem'"
